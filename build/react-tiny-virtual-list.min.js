!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["exports","react","prop-types"],t):t(e.VirtualList={},e.React,e.PropTypes)}(this,function(T,A,i){"use strict";var o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])};var e,t,f,n,O=Object.assign||function(e){for(var t,i=1,o=arguments.length;i<o;i++)for(var n in t=arguments[i])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e};(e=T.scrollAlignment||(T.scrollAlignment={})).AUTO="auto",e.START="start",e.CENTER="center",e.END="end",(t=T.ScrollDirection||(T.ScrollDirection={})).HORIZONTAL="horizontal",t.VERTICAL="vertical",(n=f||(f={})).OBSERVED="observed",n.REQUESTED="requested";var r,s,l,a,c,d=((r={})[T.ScrollDirection.VERTICAL]="scrollTop",r[T.ScrollDirection.HORIZONTAL]="scrollLeft",r),x=((s={})[T.ScrollDirection.VERTICAL]="height",s[T.ScrollDirection.HORIZONTAL]="width",s),u=((l={})[T.ScrollDirection.VERTICAL]="top",l[T.ScrollDirection.HORIZONTAL]="left",l),h=((a={})[T.ScrollDirection.VERTICAL]="marginTop",a[T.ScrollDirection.HORIZONTAL]="marginLeft",a),p=((c={})[T.ScrollDirection.VERTICAL]="marginBottom",c[T.ScrollDirection.HORIZONTAL]="marginRight",c),m=function(){function e(e){var t=e.itemCount,i=e.itemSizeGetter,o=e.estimatedItemSize;this.itemSizeGetter=i,this.itemCount=t,this.estimatedItemSize=o,this.itemSizeAndPositionData={},this.lastMeasuredIndex=-1}return e.prototype.updateConfig=function(e){var t=e.itemCount,i=e.itemSizeGetter,o=e.estimatedItemSize;null!=t&&(this.itemCount=t),null!=o&&(this.estimatedItemSize=o),null!=i&&(this.itemSizeGetter=i)},e.prototype.getLastMeasuredIndex=function(){return this.lastMeasuredIndex},e.prototype.getSizeAndPositionForIndex=function(e){if(e<0||e>=this.itemCount)throw Error("Requested index "+e+" is outside of range 0.."+this.itemCount);if(e>this.lastMeasuredIndex){for(var t=this.getSizeAndPositionOfLastMeasuredItem(),i=t.offset+t.size,o=this.lastMeasuredIndex+1;o<=e;o++){var n=this.itemSizeGetter(o);if(null==n||isNaN(n))throw Error("Invalid size returned for index "+o+" of value "+n);this.itemSizeAndPositionData[o]={offset:i,size:n},i+=n}this.lastMeasuredIndex=e}return this.itemSizeAndPositionData[e]},e.prototype.getSizeAndPositionOfLastMeasuredItem=function(){return 0<=this.lastMeasuredIndex?this.itemSizeAndPositionData[this.lastMeasuredIndex]:{offset:0,size:0}},e.prototype.getTotalSize=function(){var e=this.getSizeAndPositionOfLastMeasuredItem();return e.offset+e.size+(this.itemCount-this.lastMeasuredIndex-1)*this.estimatedItemSize},e.prototype.getUpdatedOffsetForIndex=function(e){var t=e.align,i=void 0===t?T.scrollAlignment.START:t,o=e.containerSize,n=e.currentOffset,r=e.targetIndex;if(o<=0)return 0;var s,l=this.getSizeAndPositionForIndex(r),a=l.offset,c=a-o+l.size;switch(i){case T.scrollAlignment.END:s=c;break;case T.scrollAlignment.CENTER:s=a-(o-l.size)/2;break;case T.scrollAlignment.START:s=a;break;default:s=Math.max(c,Math.min(a,n))}var f=this.getTotalSize();return Math.max(0,Math.min(f-o,s))},e.prototype.getVisibleRange=function(e){var t=e.containerSize,i=e.offset,o=e.overscanCount;if(0===this.getTotalSize())return{};var n=i+t,r=this.findNearestItem(i);if(void 0===r)throw Error("Invalid offset "+i+" specified");var s=this.getSizeAndPositionForIndex(r);i=s.offset+s.size;for(var l=r;i<n&&l<this.itemCount-1;)l++,i+=this.getSizeAndPositionForIndex(l).size;return o&&(r=Math.max(0,r-o),l=Math.min(l+o,this.itemCount-1)),{start:r,stop:l}},e.prototype.resetItem=function(e){this.lastMeasuredIndex=Math.min(this.lastMeasuredIndex,e-1)},e.prototype.findNearestItem=function(e){if(isNaN(e))throw Error("Invalid offset "+e+" specified");e=Math.max(0,e);var t=this.getSizeAndPositionOfLastMeasuredItem(),i=Math.max(0,this.lastMeasuredIndex);return t.offset>=e?this.binarySearch({high:i,low:0,offset:e}):this.exponentialSearch({index:i,offset:e})},e.prototype.binarySearch=function(e){for(var t=e.low,i=e.high,o=e.offset,n=0,r=0;t<=i;){if(n=t+Math.floor((i-t)/2),(r=this.getSizeAndPositionForIndex(n).offset)===o)return n;r<o?t=n+1:o<r&&(i=n-1)}return 0<t?t-1:0},e.prototype.exponentialSearch=function(e){for(var t=e.index,i=e.offset,o=1;t<this.itemCount&&this.getSizeAndPositionForIndex(t).offset<i;)t+=o,o*=2;return this.binarySearch({high:Math.min(t,this.itemCount-1),low:Math.floor(t/2),offset:i})},e}(),C={overflow:"auto",willChange:"transform",WebkitOverflowScrolling:"touch"},R={position:"relative",width:"100%",minHeight:"100%"},S={position:"absolute",top:0,left:0,width:"100%"},g=O({},S,{position:"sticky"}),I=function(e){function t(){var o=null!==e&&e.apply(this,arguments)||this;return o.itemSizeGetter=function(t){return function(e){return o.getSize(e,t)}},o.sizeAndPositionManager=new m({itemCount:o.props.itemCount,itemSizeGetter:o.itemSizeGetter(o.props.itemSize),estimatedItemSize:o.getEstimatedItemSize()}),o.state={offset:o.props.scrollOffset||null!=o.props.scrollToIndex&&o.getOffsetForIndex(o.props.scrollToIndex)||0,scrollChangeReason:f.REQUESTED},o.styleCache={},o.getRef=function(e){o.rootNode=e},o.handleScroll=function(e){var t=o.props.onScroll,i=o.getNodeOffset();i<0||o.state.offset===i||e.target!==o.rootNode||(o.setState({offset:i,scrollChangeReason:f.OBSERVED}),"function"==typeof t&&t(i,e))},o}return function(e,t){function i(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}(t,e),t.prototype.componentDidMount=function(){var e=this.props,t=e.scrollOffset,i=e.scrollToIndex;this.rootNode.addEventListener("scroll",this.handleScroll,{passive:!0}),null!=t?this.scrollTo(t):null!=i&&this.scrollTo(this.getOffsetForIndex(i))},t.prototype.componentWillReceiveProps=function(e){var t=this.props,i=t.estimatedItemSize,o=t.itemCount,n=t.itemSize,r=t.scrollOffset,s=t.scrollToAlignment,l=t.scrollToIndex,a=e.scrollToIndex!==l||e.scrollToAlignment!==s,c=e.itemCount!==o||e.itemSize!==n||e.estimatedItemSize!==i;e.itemSize!==n&&this.sizeAndPositionManager.updateConfig({itemSizeGetter:this.itemSizeGetter(e.itemSize)}),e.itemCount===o&&e.estimatedItemSize===i||this.sizeAndPositionManager.updateConfig({itemCount:e.itemCount,estimatedItemSize:this.getEstimatedItemSize(e)}),c&&this.recomputeSizes(),e.scrollOffset!==r?this.setState({offset:e.scrollOffset||0,scrollChangeReason:f.REQUESTED}):"number"==typeof e.scrollToIndex&&(a||c)&&this.setState({offset:this.getOffsetForIndex(e.scrollToIndex,e.scrollToAlignment,e.itemCount),scrollChangeReason:f.REQUESTED})},t.prototype.componentDidUpdate=function(e,t){var i=this.state,o=i.offset,n=i.scrollChangeReason;t.offset!==o&&n===f.REQUESTED&&this.scrollTo(o)},t.prototype.componentWillUnmount=function(){this.rootNode.removeEventListener("scroll",this.handleScroll)},t.prototype.scrollTo=function(e){var t=this.props.scrollDirection,i=void 0===t?T.ScrollDirection.VERTICAL:t;this.rootNode[d[i]]=e},t.prototype.getOffsetForIndex=function(e,t,i){void 0===t&&(t=this.props.scrollToAlignment),void 0===i&&(i=this.props.itemCount);var o=this.props.scrollDirection,n=void 0===o?T.ScrollDirection.VERTICAL:o;return(e<0||i<=e)&&(e=0),this.sizeAndPositionManager.getUpdatedOffsetForIndex({align:t,containerSize:this.props[x[n]],currentOffset:this.state&&this.state.offset||0,targetIndex:e})},t.prototype.recomputeSizes=function(e){void 0===e&&(e=0),this.styleCache={},this.sizeAndPositionManager.resetItem(e)},t.prototype.render=function(){var e,t=this,i=this.props,o=(i.estimatedItemSize,i.height),n=i.overscanCount,r=void 0===n?3:n,s=i.renderItem,l=(i.itemCount,i.itemSize,i.onItemsRendered),a=(i.onScroll,i.scrollDirection),c=void 0===a?T.ScrollDirection.VERTICAL:a,f=(i.scrollOffset,i.scrollToIndex,i.scrollToAlignment,i.stickyIndices),d=i.style,u=i.width,h=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&(i[o[n]]=e[o[n]])}return i}(i,["estimatedItemSize","height","overscanCount","renderItem","itemCount","itemSize","onItemsRendered","onScroll","scrollDirection","scrollOffset","scrollToIndex","scrollToAlignment","stickyIndices","style","width"]),p=this.state.offset,m=this.sizeAndPositionManager.getVisibleRange({containerSize:this.props[x[c]]||0,offset:p,overscanCount:r}),S=m.start,g=m.stop,I=[],z=O({},C,d,{height:o,width:u}),y=O({},R,((e={})[x[c]]=this.sizeAndPositionManager.getTotalSize(),e));if(null!=f&&0!==f.length&&(f.forEach(function(e){return I.push(s({index:e,style:t.getStyle(e,!0)}))}),c===T.ScrollDirection.HORIZONTAL&&(y.display="flex")),void 0!==S&&void 0!==g){for(var v=S;v<=g;v++)null!=f&&f.includes(v)||I.push(s({index:v,style:this.getStyle(v,!1)}));"function"==typeof l&&l({startIndex:S,stopIndex:g})}return A.createElement("div",O({ref:this.getRef},h,{style:z}),A.createElement("div",{style:y},I))},t.prototype.getNodeOffset=function(){var e=this.props.scrollDirection,t=void 0===e?T.ScrollDirection.VERTICAL:e;return this.rootNode[d[t]]},t.prototype.getEstimatedItemSize=function(e){return void 0===e&&(e=this.props),e.estimatedItemSize||"number"==typeof e.itemSize&&e.itemSize||50},t.prototype.getSize=function(e,t){return"function"==typeof t?t(e):Array.isArray(t)?t[e]:t},t.prototype.getStyle=function(e,t){var i=this.styleCache[e];if(i)return i;var o,n,r=this.props.scrollDirection,s=void 0===r?T.ScrollDirection.VERTICAL:r,l=this.sizeAndPositionManager.getSizeAndPositionForIndex(e),a=l.size,c=l.offset;return this.styleCache[e]=t?O({},g,((o={})[x[s]]=a,o[h[s]]=c,o[p[s]]=-(c+a),o.zIndex=1,o)):O({},S,((n={})[x[s]]=a,n[u[s]]=c,n))},t.defaultProps={overscanCount:3,scrollDirection:T.ScrollDirection.VERTICAL,width:"100%"},t.propTypes={estimatedItemSize:i.number,height:i.oneOfType([i.number,i.string]).isRequired,itemCount:i.number.isRequired,itemSize:i.oneOfType([i.number,i.array,i.func]).isRequired,onScroll:i.func,onItemsRendered:i.func,overscanCount:i.number,renderItem:i.func.isRequired,scrollOffset:i.number,scrollToIndex:i.number,scrollToAlignment:i.oneOf([T.scrollAlignment.AUTO,T.scrollAlignment.START,T.scrollAlignment.CENTER,T.scrollAlignment.END]),scrollDirection:i.oneOf([T.ScrollDirection.HORIZONTAL,T.ScrollDirection.VERTICAL]),stickyIndices:i.arrayOf(i.number),style:i.object,width:i.oneOfType([i.number,i.string])},t}(A.PureComponent);T.default=I,Object.defineProperty(T,"__esModule",{value:!0})});
